# Project TODO

- [x] Configurar design system com cores da marca Bem Casado (vermelho #E63946)
- [x] Criar componente de visualização da loja (31m x 15m x 8m)
- [x] Adicionar pallets com produtos no layout
- [x] Posicionar 2 caixas registradoras no lado direito
- [x] Implementar vista superior e isométrica
- [x] Adicionar identidade visual da marca
- [x] Criar painel de informações dos produtos
- [x] Implementar interação ao clicar nos produtos
- [x] Adicionar medidas e dimensões visíveis
- [x] Criar legenda de produtos com cores
- [x] Adicionar controles de visualização
- [x] Adicionar etiquetas de preços nos pallets
- [x] Criar modal com informações detalhadas do produto (peso, validade, lote)
- [x] Implementar sistema de visualização de informações ao clicar
- [x] Atualizar preços reais dos produtos Bem Casado
- [x] Adicionar informações de desconto e preço de tabela
- [x] Incluir açúcar cristal no catálogo

- [x] Criar contexto de carrinho de compras (CartContext)
- [x] Implementar componente de carrinho flutuante
- [x] Adicionar botão de adicionar ao carrinho no modal de produtos
- [x] Calcular subtotal, quantidade total de itens
- [x] Implementar botão de finalizar pedido
- [x] Gerar mensagem formatada para WhatsApp com lista de produtos
- [x] Adicionar botão de limpar carrinho
- [x] Mostrar badge com quantidade de itens no ícone do carrinho

- [x] Criar sistema de cupons de desconto
- [x] Adicionar campo de entrada de cupom no carrinho
- [x] Implementar validação de cupons em tempo real
- [x] Calcular desconto e aplicar ao total
- [x] Mostrar feedback visual de cupom válido/inválido
- [x] Exibir economia total no resumo do pedido
- [x] Incluir informação do cupom na mensagem do WhatsApp
- [x] Criar seção de cupons disponíveis na página

- [x] Criar sistema de notificações de estoque baixo
- [x] Adicionar badge de "Estoque Baixo" nos produtos com menos de 50 unidades
- [x] Implementar alerta visual no modal de produtos
- [x] Criar função para sugerir produtos alternativos similares
- [x] Adicionar seção de produtos alternativos no modal
- [x] Mostrar quantidade disponível em estoque no modal
- [x] Adicionar badges visuais nos pallets da loja

- [x] Criar componente de busca e filtros
- [x] Implementar campo de pesquisa por nome/marca
- [x] Adicionar filtros por categoria (arroz, feijão, açúcar)
- [x] Implementar filtro por faixa de preço com slider
- [x] Adicionar ordenação (preço crescente/decrescente, estoque, nome A-Z)
- [x] Integrar filtros com visualização da loja
- [x] Destacar produtos filtrados na visualização
- [x] Adicionar contador de produtos encontrados
- [x] Implementar botão de limpar filtros

- [x] Criar componente de visualização em lista/grade
- [x] Adicionar botão de alternância entre visualização de pallets e lista
- [x] Implementar layout de grade com cards de produtos
- [x] Adicionar foto/cor do produto em cada card
- [x] Mostrar informações principais (nome, marca, peso, preço, estoque)
- [x] Adicionar botão "Adicionar ao Carrinho" direto no card
- [x] Implementar badges de estoque baixo nos cards
- [x] Manter integração com filtros e busca
- [x] Adicionar mensagem quando nenhum produto é encontrado

- [x] Criar dados de ofertas promocionais com prazo de validade
- [x] Implementar componente de banner rotativo de promoções
- [x] Adicionar timer de contagem regressiva para ofertas
- [x] Criar filtro rápido "Somente Promoções" na busca
- [x] Adicionar seção de destaques promocionais na página inicial
- [x] Implementar carrossel automático de banners
- [x] Adicionar indicadores de navegação no carrossel
- [x] Destacar produtos em promoção com badge especial

- [x] Criar página "Sobre Nós"
- [x] Adicionar seção de história da empresa
- [x] Implementar seção de missão e valores
- [x] Criar seção de certificações de qualidade (ANVISA, ISO 9001, MAPA, HACCP)
- [x] Implementar formulário de contato com validação
- [x] Adicionar mapa de localização integrado do Google Maps
- [x] Criar navegação no header para acessar a página
- [x] Adicionar informações de horário de funcionamento
- [x] Implementar seção de contatos (telefone, email, endereço)
- [x] Adicionar botão de voltar para a loja

- [x] Criar galeria de fotos da fábrica
- [x] Gerar imagens representativas da fábrica e processo produtivo
- [x] Implementar grid responsivo de fotos (1-3 colunas)
- [x] Adicionar lightbox para visualização ampliada em tela cheia
- [x] Implementar navegação entre fotos no lightbox (setas e teclado)
- [x] Adicionar legendas descritivas nas fotos
- [x] Integrar galeria na página Sobre Nós
- [x] Adicionar efeitos hover e transições suaves
- [x] Implementar indicadores de posição no lightbox

- [x] Criar botão flutuante de WhatsApp
- [x] Implementar mensagem pré-formatada com produtos do carrinho
- [x] Adicionar indicador de horário de atendimento
- [x] Posicionar botão no canto inferior direito
- [x] Adicionar animação de pulse para chamar atenção
- [x] Integrar com contexto do carrinho
- [x] Mostrar badge de "Online" durante horário comercial
- [x] Adicionar tooltip com informações de horário
- [x] Mostrar badge com quantidade de itens no carrinho

- [x] Criar componente de newsletter no rodapé
- [x] Implementar campo de email com validação em tempo real
- [x] Adicionar validação de formato de email
- [x] Criar toast de confirmação de cadastro
- [x] Gerar cupom automático NEWSLETTER5 (5% OFF)
- [x] Adicionar cupom NEWSLETTER5 ao sistema de cupons
- [x] Salvar emails cadastrados no LocalStorage
- [x] Prevenir cadastros duplicados
- [x] Adicionar animação de sucesso ao cadastrar
- [x] Criar componente de Footer com informações de contato
- [x] Copiar cupom automaticamente para área de transferência

- [x] Criar sistema de clube VIP Bem Casado
- [x] Definir planos de assinatura (Básico R$ 89,90 e Premium R$ 149,90)
- [x] Implementar página de apresentação do clube
- [x] Criar componente de cards de planos com benefícios
- [x] Adicionar sistema de gestão de membros no LocalStorage
- [x] Implementar descontos exclusivos para membros (10% e 15%)
- [x] Adicionar seção de benefícios e vantagens
- [x] Implementar simulador de economia anual interativo
- [x] Criar botão de adesão ao clube
- [x] Adicionar link do Clube VIP no header
- [x] Criar formulário de cadastro de membros

- [x] Simplificar layout da página inicial
- [x] Remover elementos visuais excessivos
- [x] Reorganizar informações de forma mais limpa
- [x] Reduzir quantidade de informações visíveis simultaneamente
- [x] Melhorar hierarquia visual
- [x] Criar layout mais minimalista e profissional
- [x] Remover seção de cupons disponíveis da página inicial
- [x] Adicionar imagem da fachada vermelha da Bem Casado na visualização
- [x] Substituir vista 3D por foto real da fachada
- [x] Criar cards informativos com dimensões e localização
- [x] Adicionar preview compacto de produtos (10 primeiros)
- [x] Remover card de dimensões da loja
- [x] Ajustar grid de informações para 2 colunas
- [x] Remover texto de dimensões do overlay da imagem
- [x] Remover overlay de texto sobre a imagem da fachada
- [x] Gerar imagem do galpão vazio sem produtos
- [x] Substituir imagem da fachada por versão com interior vazio
- [x] Gerar imagem com 2 caixas registradoras do lado direito embaixo da tenda
- [x] Substituir imagem do galpão vazio por versão com caixas posicionadas
- [x] Reposicionar caixas registradoras mais próximas da porta de entrada
- [x] Manter caixas do lado direito mas mais perto da entrada
- [x] Retornar caixas para posição anterior (mais ao fundo do lado direito)
- [x] Gerar imagem com 6 fileiras de pallets (4 posições cada)
- [x] Organizar produtos nos pallets: arroz integral, arroz branco, açúcar cristal, feijão carioca, feijão preto
- [x] Criar layout organizado do galpão com produtos visíveis
- [x] Posicionar caixas registradoras ao fundo do lado direito
- [x] Remover arroz parboilizado da lista de produtos
- [x] Atualizar catálogo de produtos
- [x] Atualizar contagem total de produtos para 5
- [x] Visualizar catálogo PDF da Bem Casado
- [x] Extrair fotos dos produtos do catálogo
- [x] Atualizar produtos com imagens reais
- [x] Adicionar informações do catálogo oficial
- [x] Copiar imagem do açúcar cristal para o projeto
- [x] Remover fundo da imagem do açúcar cristal
- [x] Atualizar catálogo de produtos com imagens reais do catálogo
- [x] Manter apenas 5 produtos de 1kg: arroz branco, arroz integral, feijão carioca, feijão preto, açúcar cristal

- [x] Substituir quadrados coloridos por imagens reais dos produtos na seção "Produtos Disponíveis"
- [x] Atualizar componente StoreVisualization para exibir fotos dos produtos

- [x] Atualizar todos os produtos para kits de 10 unidades (fardos de 10kg)
- [x] Multiplicar preço unitário por 10 para preço do fardo
- [x] Atualizar descrição dos produtos indicando venda em fardos
- [x] Adicionar preço de tabela e desconto para todos os produtos

- [x] Reposicionar caixas registradoras mais para a esquerda
- [x] Adicionar espaçamento de 2 metros entre as 2 caixas
- [x] Gerar nova imagem do galpão com caixas reposicionadas

- [x] Adicionar "Kit com 10 unidades" na descrição de cada produto

- [x] Adicionar badge visual "10 UN" nas imagens dos produtos
- [x] Criar versão das imagens com indicação de kit

- [x] Adicionar texto "10 un." entre o nome do produto e o preço nos cards
- [x] Atualizar ProductGridView e StoreVisualization

- [x] Voltar para a fachada original (foto real do vídeo)
- [x] Remover o "9" do número do WhatsApp (12) 93197-3400 → (12) 3197-3400
- [x] Atualizar horário de funcionamento: sábados e domingos das 7h às 13h

- [x] Restaurar imagem da fachada anterior (galpão com pallets organizados)

- [x] Atualizar horário de funcionamento: loja funciona APENAS sábados e domingos das 7h às 13h (remover horário de segunda a sexta)

- [x] Atualizar localização para "Fábrica de arroz" em todos os componentes
- [x] Adicionar coordenadas GPS corretas (-23.187869, -45.764573) no mapa do Google Maps

- [x] Adicionar botão "Como Chegar" que abre Google Maps com coordenadas GPS para navegação

- [x] Simplificar e destacar botão "Como Chegar" removendo coordenadas em texto
- [x] Aplicar design mais chamativo com cores vibrantes e animações

- [x] Substituir imagem do galpão pela foto real da fachada da Bem Casado

- [x] Gerar nova imagem combinando galpão organizado com pallets e letreiro real "Bem Casado"

- [x] Corrigir botão do WhatsApp que não está abrindo

- [x] Adicionar funcionalidade de servidor (web-db-user) ao projeto
- [x] Integrar SafraPay para pagamentos com cartão de crédito e vales alimentação
- [x] Criar fluxo de checkout com SafraPay
- [x] Adicionar página de confirmação de pagamento
- [x] Testar fluxo completo de compra

- [x] Melhorar visibilidade do botão "Adicionar ao Carrinho" nos cards de produtos

- [x] Corrigir exibição do botão "Adicionar ao Carrinho" nos cards de produtos

- [x] Adicionar indicador de carregamento (skeleton) para imagens dos produtos

- [x] Diagnosticar e corrigir problema de carregamento de imagens no Chrome mobile

- [x] Corrigir exibição de imagem do produto no carrinho de compras

- [x] Corrigir exibição de imagem do produto no carrinho de compras

- [x] Corrigir botão "Finalizar Compra" para redirecionar ao checkout SafraPay em vez de limpar carrinho

- [x] Implementar geração de PIX em produção com CNPJ 14.295.527/0001-30 para Banco do Brasil
- [x] Adicionar QR Code PIX real na página de checkout

- [x] Diagnosticar e corrigir problema de geração automática do código PIX no checkout

- [x] Corrigir chave PIX de 14295527000130 para 14295537000130

- [x] Implementar timer de 10 minutos para pagamento PIX
- [x] Adicionar contagem regressiva visual no modal (MM:SS)
- [x] Expirar QR Code automaticamente após 10 minutos
- [x] Mostrar mensagem de expiração quando o tempo acabar
- [x] Adicionar botão para gerar novo pedido após expiração

- [x] Criar módulo de envio de email via Gmail MCP (server/email.ts)
- [x] Implementar função sendPixConfirmationEmail com template profissional
- [x] Baixar e anexar QR Code em alta resolução ao email
- [x] Incluir código PIX Copia e Cola no corpo do email
- [x] Adicionar resumo do pedido (produtos, valores, cupom)
- [x] Incluir aviso de expiração de 10 minutos
- [x] Adicionar informações de contato da loja no email
- [x] Integrar envio de email no endpoint de geração de PIX
- [x] Tornar campo de email obrigatório no checkout
- [ ] Testar envio de email com pedido real
- [x] Investigar por que email não foi enviado
- [x] Verificar logs do servidor para identificar erro
- [x] Testar integração com Gmail MCP manualmente
- [x] Corrigir problema de envio de email (usar arquivo temporário para JSON)
- [ ] Testar novamente envio de email após correção

- [x] Email PIX ainda não está sendo enviado - investigar causa raiz
- [x] Criar script de teste manual para envio de email via Gmail MCP
- [x] Verificar se Gmail MCP está autenticado corretamente
- [x] Descoberto: Gmail MCP não funciona via execAsync no backend
- [x] Implementar Nodemailer com SMTP do Gmail
- [x] Instalar pacote nodemailer no projeto
- [x] Reescrever módulo email.ts para usar Nodemailer
- [ ] Configurar credenciais SMTP (noreply@arrozbemcasado.com.br)
- [ ] Aguardando senha de app do Gmail do usuário
- [ ] Testar envio de email com anexo de QR Code via Nodemailer
- [ ] Validar funcionamento completo do fluxo PIX + Email

## Correção Ícone PWA

- [x] Investigar por que ícone aparece como globo genérico ao invés do logo Bem Casado (pasta /icons/ estava faltando)
- [x] Verificar se ícones estão sendo servidos corretamente (recriados)
- [x] Verificar caminhos no manifest.json (manifest.json recriado com caminhos corretos)
- [x] Testar se ícones existem e são acessíveis (ícones gerados em 180x180, 192x192, 512x512)
- [x] Corrigir configuração se necessário (manifest, service worker e HTML atualizados)

## Banner Fixo de Download do App (Solução para Problema de Reinstalação)

- [x] Criar componente AppDownloadBanner sempre visível
- [x] Posicionar logo abaixo do header
- [x] Design chamativo com gradiente vermelho (from-primary via-red-600 to-primary)
- [x] Botão "Baixar Agora" que aciona instalação PWA
- [x] Botão "X" para fechar (salvar preferência no localStorage)
- [x] Detectar se app já está instalado em modo standalone (não mostrar)
- [x] Mostrar instruções por plataforma se navegador não suportar PWA (iOS/Android/Desktop)
- [x] Responsivo mobile e desktop

## Integração de Vídeo "Como Chegar" com Google Maps

- [x] Converter vídeo MOV para MP4 (melhor compatibilidade web)
- [x] Comprimir vídeo de ~100MB para 98MB (1min15s de duração)
- [x] Fazer upload do vídeo para client/public/videos/como-chegar.mp4
- [x] Criar componente modal HowToGetThereModal
- [x] Adicionar player de vídeo responsivo no modal (aspect-ratio 9:16)
- [x] Integrar Google Maps iframe no modal abaixo do vídeo
- [x] Adicionar botão "Abrir Navegação no Google Maps" (abre em nova aba)
- [x] Conectar modal ao botão "Como Chegar" em StoreVisualization
- [x] Adicionar informações de endereço no modal

## Correção: Vídeo não aparece no modal Como Chegar

- [x] Verificar se arquivo de vídeo existe no caminho correto (arquivo estava presente)
- [x] Verificar caminho do vídeo no componente HowToGetThereModal (caminho correto)
- [x] Identificar problema: vídeo muito grande (98MB) causava lentidão no carregamento
- [x] Comprimir vídeo de 98MB para 19MB (redução de 80%)
- [x] Reduzir resolução de 1440x2560 para 720x1280 (HD, mantendo qualidade visual)
- [x] Adicionar atributos preload="metadata" e playsInline no player
- [x] Remover poster inexistente que causava erro
- [x] Adicionar max-w-md e centralização para melhor visualização

## Correção: Modal "Como Chegar" não abre ao clicar no botão

- [ ] Verificar se há erros no console do navegador
- [ ] Verificar se o componente HowToGetThereModal está sendo importado corretamente
- [ ] Verificar se o estado isHowToGetThereModalOpen está funcionando
- [ ] Verificar se há conflito com outros modais ou componentes
- [ ] Testar abertura do modal no navegador

## Adicionar Ícones de Formas de Pagamento SafraPay

- [x] Pesquisar todas as bandeiras de cartões aceitas pelo SafraPay
- [x] Criar componente com ícones visuais das bandeiras (Mastercard, Visa, Elo, Amex, Hipercard, etc)
- [x] Adicionar seção de formas de pagamento no rodapé com ícones coloridos
- [x] Adicionar seção de formas de pagamento no carrinho com ícones coloridos
- [x] Incluir vales alimentação aceitos (Alelo, Sodexo, Ticket, VR, iFood)

## Adicionar Ícones de Bandeiras na Página de Checkout

- [x] Adicionar ícones visuais das bandeiras nas opções de pagamento (Cartão de Crédito, Débito, Vale Alimentação)
- [x] Mostrar ícones Visa, Mastercard, Elo, Amex, Hipercard ao lado de "Cartão de Crédito"
- [x] Mostrar ícones Visa, Mastercard, Elo ao lado de "Cartão de Débito"
- [x] Mostrar ícones Alelo, Sodexo, Ticket, VR, iFood ao lado de "Vale Alimentação"
- [x] Adicionar ícone Pix na opção de pagamento via Pix

## Implementar Limpeza Automática de Cache

- [x] Configurar cache-busting automático no Vite para assets (JS, CSS, imagens)
- [x] Implementar detecção de nova versão da aplicação
- [x] Criar sistema de atualização automática quando nova versão estiver disponível
- [x] Configurar Service Worker para controle de cache
- [x] Adicionar headers HTTP adequados para controle de cache no servidor
- [x] Implementar notificação visual para usuário quando houver atualização disponível

## Implementar Segurança Adicional para Pagamentos com Cartão

- [x] Adicionar validação de número de cartão (algoritmo de Luhn)
- [x] Implementar validação de data de validade e CVV
- [x] Adicionar detecção de bandeira do cartão automaticamente
- [x] Implementar rate limiting para tentativas de pagamento
- [x] Adicionar proteção contra ataques de força bruta
- [x] Criar sistema de logs de auditoria para todas as transações
- [x] Implementar verificação de CVV obrigatória
- [x] Adicionar validação de endereço (AVS - Address Verification System)
- [x] Implementar tokenização de cartões (não armazenar dados sensíveis)
- [x] Adicionar alertas para transações suspeitas
- [x] Implementar HTTPS obrigatório para todas as páginas de pagamento
- [x] Adicionar Content Security Policy (CSP) headers
- [x] Criar documentação de conformidade PCI DSS

## Criar Painel Administrativo Completo

- [ ] Criar rotas tRPC para gerenciamento de produtos (listar, editar, criar, deletar)
- [ ] Criar página de painel administrativo (/admin)
- [ ] Implementar listagem de produtos com busca e filtros
- [ ] Adicionar formulário de edição de preços individuais
- [ ] Implementar edição de estoque
- [ ] Adicionar sistema de autenticação para admin
- [ ] Criar interface para adicionar novos produtos
- [ ] Implementar exclusão de produtos

## Remover Selo "Aceita Vale" dos Produtos

- [x] Localizar componente que exibe o selo "Aceita Vale"
- [x] Remover selo verde "Aceita Vale" dos cards de produtos

## Melhorar Ícones de Formas de Pagamento

- [x] Unificar opções de crédito e débito em "Cartão de Crédito/Débito"
- [x] Melhorar resolução dos ícones de cartões (Visa, Mastercard, Elo, Hipercard, Amex)
- [x] Melhorar resolução dos ícones de vales (Alelo, Sodexo, Ticket, VR, iFood)
- [x] Aumentar tamanho dos ícones para melhor visualização
- [x] Atualizar checkout com nova estrutura
- [x] Atualizar rodapé e carrinho

## Melhorar Ícones de Formas de Pagamento

- [x] Unificar opções de crédito e débito em "Cartão de Crédito/Débito"
- [x] Melhorar resolução dos ícones de cartões (Visa, Mastercard, Elo, Hipercard, Amex)
- [x] Melhorar resolução dos ícones de vales (Alelo, Sodexo, Ticket, VR, iFood)
- [x] Aumentar tamanho dos ícones para melhor visualização
- [x] Atualizar checkout com nova estrutura
- [x] Atualizar rodapé e carrinho

## Corrigir Logos das Bandeiras de Pagamento

- [x] Pesquisar logos oficiais de Visa, Mastercard, Elo, Hipercard, Amex
- [x] Pesquisar logos oficiais de Alelo, Sodexo, Ticket, VR, iFood
- [x] Pesquisar logo oficial do PIX
- [x] Redesenhar SVGs fiéis aos originais
- [x] Testar visualização

## Criar Script de Seed para Produtos

- [x] Identificar os 5 produtos atuais e suas informações (nome, preço, estoque, imagem)
- [x] Criar script seed.mjs para popular banco de dados
- [x] Executar script e verificar dados inseridos (via SQL direto)
- [x] Produtos disponíveis no painel administrativo
- [x] Testar visualização dos produtos no painel admin

## Atualizar Logos Hipercard, American Express e Vales Alimentação

- [x] Redesenhar logo Hipercard (vermelho com texto branco itálico em retângulo)
- [x] Redesenhar logo American Express (azul com "AMERICAN EXPRESS" em branco)
- [x] Redesenhar logo Sodexo (roxo escuro com garfo e faca brancos)
- [x] Redesenhar logo Ticket (branco com círculo vermelho e faixa "Alimentação")
- [x] Redesenhar logo VR (verde com texto branco e faixa laranja "Refeição")
- [x] Redesenhar logo Alelo (verde-água/turquesa com texto branco)
- [x] Manter mesmo tamanho e proporções dos logos existentes
- [x] Testar visualização em checkout, rodapé e carrinho
- [x] Verificar harmonia visual com outros logos

## Alterar Preços dos Produtos

- [x] Arroz Branco Polido Tipo 1 (kit 10kg): R$ 23,50
- [x] Arroz Integral Tipo 1 (kit 10kg): R$ 29,90
- [x] Feijão Carioca Tipo 1 (kit 10kg): R$ 39,90
- [x] Feijão Preto Tipo 1 (kit 10kg): R$ 29,90
- [x] Açúcar Cristal (kit 10kg): R$ 29,90
- [x] Verificar atualização no site
- [x] Verificar atualização no painel admin

## Atualizar Estoque dos Produtos (em kits)

- [x] Açúcar Cristal: 150 kits
- [x] Arroz Branco Polido Tipo 1: 300 kits
- [x] Arroz Integral Tipo 1: 100 kits
- [x] Feijão Carioca Tipo 1: 200 kits
- [x] Feijão Preto Tipo 1: 150 kits
- [x] Verificar atualização no site
- [x] Verificar atualização no painel admin

## Simplificar Logos de Pagamento

- [x] Substituir logos SVG complexos por badges simples com texto
- [x] Usar cores oficiais das bandeiras
- [x] Garantir compatibilidade total com todos os navegadores
- [x] Testar visualização no rodapé
- [x] Verificar responsividade mobile

## Atualizar Preços e Descrições

- [x] Atualizar preço do Arroz Integral de R$ 29,90 para R$ 23,50
- [x] Alterar "10 un." para "10 un. 1kg" em todos os produtos
- [x] Verificar atualização no site

## Adicionar Vídeo em Área de Como Chegar

- [x] Identificar as duas áreas com "Como Chegar"
- [x] Adicionar vídeo na área que está faltando (rodapé)
- [x] Verificar vídeo funcionando em ambas as áreas

## Banner de Inauguração

- [x] Criar componente de banner com animação flash
- [x] Adicionar mensagem de inauguração dias 29 e 30 de novembro
- [x] Posicionar no topo do site
- [x] Testar animação e responsividade

## Sistema PDV + PEPS (FIFO)

### Banco de Dados
- [x] Adicionar campo ean13 na tabela products
- [x] Criar tabela stock_batches (lotes)
- [x] Criar tabela stock_movements (movimentações)
- [x] Migrar schema do banco

### Produtos
- [x] Adicionar EAN-13 em todos os produtos
- [x] Criar produto Arroz Branco 5KG
- [ ] Atualizar interface de produtos

### Sistema PEPS
- [ ] Criar API de gestão de lotes
- [ ] Implementar lógica PEPS (baixa automática do lote mais antigo)
- [ ] Criar alertas de vencimento
- [ ] Criar relatórios de movimentação
- [ ] Calcular custo médio ponderado

### PDV (Ponto de Venda)
- [x] Criar página /pdv
- [x] Implementar leitor de código de barras
- [x] Criar interface de venda
- [x] Sistema de busca por EAN-13
- [x] Carrinho de vendas no PDV
- [x] Finalização de venda com baixa automática de estoque
- [ ] Adicionar atalhos de teclado
- [ ] Implementar baixa PEPS por lote (quando sistema de lotes estiver pronto)

### Testes
- [x] Testar sistema PDV (5 testes passando)
- [x] Testar processamento de vendas
- [x] Testar baixa automática de estoque
- [x] Testar validação de estoque insuficiente
- [x] Testar vendas com múltiplos produtos
- [ ] Testar scanner de código de barras físico (requer hardware)
- [ ] Testar baixa PEPS por lote (quando implementado)
- [ ] Testar alertas de vencimento (quando implementado)

## Integração NFC-e (Nota Fiscal Eletrônica)

### Análise e Configuração
- [ ] Analisar planilha de cadastro da empresa
- [ ] Extrair dados fiscais (CNPJ, IE, endereço, regime tributário)
- [ ] Configurar certificado digital A1 (.pfx)
- [ ] Instalar bibliotecas necessárias (node-forge, xml-crypto, axios)

### Implementação NFC-e
- [ ] Criar módulo de geração de XML NFC-e (layout SEFAZ 4.0)
- [ ] Implementar assinatura digital com certificado A1
- [ ] Integrar comunicação SOAP com webservices SEFAZ-SP
- [ ] Criar função de envio e autorização de NFC-e
- [ ] Implementar tratamento de rejeições e erros
- [ ] Gerar DANFE (PDF) da nota autorizada

### Integração PDV
- [ ] Adicionar botão "Emitir NFC-e" no PDV
- [ ] Integrar emissão de nota no fluxo de finalização de venda
- [ ] Exibir DANFE após autorização
- [ ] Permitir download/impressão do DANFE
- [ ] Salvar XMLs autorizados no banco de dados

### Testes
- [ ] Testar geração de XML
- [ ] Testar assinatura digital
- [ ] Testar envio para ambiente de homologação
- [ ] Validar DANFE gerado
- [ ] Testar fluxo completo no PDV

## Integração Tiny ERP - NFC-e
- [x] Criar módulo de integração com API do Tiny
- [x] Implementar envio de venda para Tiny
- [x] Receber NFC-e (XML e DANFE) do Tiny
- [x] Atualizar PDV para emitir NFC-e ao finalizar venda
- [x] Configurar Token de API do Tiny ERP
- [x] Criar rota tRPC para emissão de NFC-e
- [x] Integrar emissão de NFC-e no PDV
- [x] Abrir DANFE automaticamente após emissão
- [ ] Testar emissão em ambiente de homologação
- [ ] Configurar ambiente de produção

- [ ] Configurar FOCUS_NFE_TOKEN via secrets
- [ ] Implementar módulo de integração com Focus NFe API
- [ ] Substituir código de emissão Tiny ERP por Focus NFe
- [ ] Adicionar campo de email do cliente no PDV
- [ ] Implementar envio automático de DANFE por email
- [ ] Testar emissão real de NFC-e com Focus NFe
- [ ] Validar recebimento de email com DANFE

## Envio Automático de DANFE por WhatsApp

- [x] Implementar envio automático de DANFE por WhatsApp após emissão de NFC-e
- [x] Adicionar campo de telefone opcional no PDV
- [x] Gerar mensagem formatada com link do DANFE, chave de acesso e QR Code
- [x] Testar envio de DANFE por WhatsApp

## Painel de Gestão de Notas Fiscais

- [x] Criar schema de banco de dados para histórico de NFC-e
- [x] Implementar endpoints TRPC para consulta de notas
- [x] Implementar endpoint para cancelamento de NFC-e
- [x] Implementar endpoint para reenvio de DANFE
- [x] Criar interface do painel de gestão
- [x] Adicionar filtros por data e status
- [x] Implementar visualização de detalhes da nota
- [x] Adicionar relatórios e estatísticas
- [x] Testar todas as funcionalidades

## Atualização do Banner de Destaque

- [x] Atualizar banner para anunciar funcionamento dias 06 e 07/12 das 7h às 13h

## Atualização de Preços

- [x] Atualizar preço do Arroz Branco para R$ 23,00
- [x] Atualizar preço do Arroz Integral para R$ 23,00

## Atualização do Banner - Remover dia 07/12

- [x] Atualizar banner para anunciar apenas dia 06 de dezembro

## Correção de Preços - Arroz

- [x] Verificar IDs corretos dos produtos de arroz
- [x] Atualizar preços para R$ 23,00


## Sistema de Produtos Dinâmico (Buscar do Banco)

- [x] Criar endpoint tRPC products.list para buscar produtos do banco
- [x] Atualizar Home.tsx para usar trpc.products.list.useQuery()
- [x] Atualizar StoreVisualization.tsx para receber produtos via props
- [x] Atualizar ProductGridView.tsx para receber produtos via props
- [x] Sincronizar dados do products.ts com tabela products do banco
- [x] Testar carregamento de produtos do banco
- [x] Verificar que alterações no painel /admin refletem no site


## Correção: Produtos sumindo após alteração no painel /admin

- [x] Verificar estado dos produtos no banco de dados
- [x] Identificar causa do problema (useMemo faltando dependência)
- [x] Corrigir problema (adicionar products nas dependências do useMemo)
- [x] Testar alteração de preço no painel /admin
- [x] Verificar que produtos continuam visíveis após alteração


## Resolver erro de publicação

- [ ] Verificar status do projeto e checkpoints
- [ ] Identificar causa do erro de upload
- [ ] Resolver problema de publicação
- [ ] Confirmar que site foi publicado com sucesso


## Recriar produto Açúcar Cristal

- [x] Verificar se produto existe no banco
- [x] Recriar produto com preço R$ 29,90
- [x] Testar visualização no site
- [x] Criar checkpoint


## Post Instagram - Degustação Arroz Integral

- [x] Gerar imagem promocional do Arroz Integral
- [x] Criar legenda atrativa para o post
- [x] Adicionar hashtags relevantes
- [x] Entregar post completo ao usuário


## Atualizar Post Instagram com imagens reais

- [x] Localizar imagem do produto Arroz Integral
- [x] Localizar imagem da loja de fábrica
- [x] Criar nova versão do post combinando as imagens
- [x] Entregar post atualizado ao usuário


## Vídeo Story Instagram - Degustação

- [x] Criar script Python para gerar vídeo
- [x] Adicionar animações e textos dinâmicos
- [x] Gerar vídeo de 15 segundos
- [x] Entregar vídeo ao usuário


## Refazer Vídeo Story - Design Profissional

- [x] Criar novo script com design moderno e clean
- [x] Melhorar tipografia e layout
- [x] Gerar design profissional com IA
- [x] Entregar material profissional


## Corrigir Imagem do Açúcar Cristal

- [x] Investigar por que imagem do açúcar cristal não aparece
- [x] Verificar caminho da imagem no código
- [x] Corrigir problema da imagem
- [x] Testar no navegador


## Testar Emissão de NFC-e em Homologação

- [ ] Verificar configuração do Focus NFe (ambiente de homologação)
- [ ] Criar pedido de teste no sistema
- [ ] Emitir NFC-e de teste
- [ ] Verificar se nota foi autorizada
- [ ] Validar dados da nota (produtos, valores, impostos)


## Implementar NCM por Produto

- [x] Adicionar campo `ncm` na tabela products (schema)
- [x] Criar migration para adicionar coluna NCM
- [x] Atualizar produtos com NCM corretos no banco
- [x] Modificar código focus-nfe.ts para usar NCM do produto
- [x] Testar emissão de NFC-e com NCM corretos


## Implementar ICMS Condicional para Arroz e Feijão

- [x] Adicionar lógica para identificar produtos da cesta básica (arroz e feijão)
- [x] Implementar isenção de ICMS (padrão)
- [x] Base reduzida (7%) APENAS para CNPJ com Inscrição Estadual
- [x] Adicionar campo opcional para Inscrição Estadual
- [ ] Testar emissão: sem CPF, com CPF, com CNPJ sem IE, com CNPJ com IE


## Correção de Preço

- [x] Corrigir preço do açúcar cristal de R$ 29,80 para R$ 29,90


## Correção de NCM do Feijão

- [x] Corrigir NCM do feijão carioca e preto de 07133300 para 07133399
- [x] Atualizar código focus-nfe.ts para reconhecer novo NCM como cesta básica


## Implementar Tributação do Açúcar

- [x] Implementar CST 060 (ICMS cobrado anteriormente por ST) para açúcar
- [x] Sem destaque de ICMS (já recolhido na origem)
- [x] Adicionar CEST 17.101.00 ao banco de dados
- [x] Diferenciar tributação: Açúcar (CST 060) vs Arroz/Feijão (CST 040/020)

## Corrigir CEST - Apenas Açúcar

- [ ] Verificar CEST atual de todos os produtos no banco
- [ ] Remover CEST de arroz branco e arroz integral (não tem ST)
- [ ] Remover CEST de feijão carioca e feijão preto (não tem ST)
- [ ] Confirmar que apenas açúcar cristal tem CEST 17.101.00

## Atualizar Dados da NFC-e com Informações Corretas

- [x] Atualizar Inscrição Estadual: 645.342.314.116
- [x] Atualizar endereço completo (Estrada Municipal Santo Antônio do Alto, 257)
- [x] Atualizar CEP: 12.225-810
- [x] Atualizar bairro: Parque Novo Horizonte
- [x] Atualizar telefone: (12) 98194-9314
- [x] Atualizar Inscrição Municipal: 304129
- [x] Atualizar CNAE: 4632003
- [x] Atualizar email para notificações: controladoria@arrozvaledosul.com.br
- [x] Adicionar CSC (Token): 64ec579e-65eb-48f9-b2ef-42fc57984476
- [x] Adicionar ID do Token (CSC): 000001
- [x] Confirmar Regime Tributário: Lucro Real

## Testar Emissão de NFC-e Após Cadastro SEFAZ

- [x] Criar teste de emissão com produto real (açúcar)
- [x] Executar emissão via API Focus NFe
- [x] Verificar se erro 245 foi resolvido
- [x] Validar XML gerado com CST correto
- [x] Confirmar autorização da SEFAZ-SP

## Ajustar CRT para Lucro Real

- [x] Alterar regime_tributario_emitente de 1 para 3 (Lucro Real)
- [x] Atualizar script de teste com CRT=3
- [x] Testar emissão de NFC-e novamente
- [x] Verificar se erro 590 foi resolvido
- [x] Corrigir CFOP de 5102 para 5405 (açúcar com ST)
- [x] NFC-e autorizada com sucesso pela SEFAZ-SP (Nota #1)

## Implementar Download de XML e DANFE para Cliente Final

- [x] Adicionar campos caminho_xml e caminho_danfe na resposta do checkout
- [x] Criar modal "Nota Fiscal Emitida" após pagamento confirmado
- [x] Adicionar botão "Baixar XML da Nota Fiscal"
- [x] Adicionar botão "Visualizar DANFE" (abre em nova aba)
- [x] Exibir QR Code para consulta na SEFAZ
- [x] Mostrar chave de acesso e número da nota
- [x] Implementar emissão automática de NFC-e após confirmação de pagamento
- [x] Envio automático do DANFE por email
- [ ] Testar fluxo: compra → pagamento → NFC-e → download

## Adicionar Campo CPF/CNPJ no Checkout

- [x] Adicionar campo CPF/CNPJ no formulário de checkout
- [x] Implementar máscara de formatação (CPF: 000.000.000-00, CNPJ: 00.000.000/0000-00)
- [x] Criar função de validação de CPF
- [x] Criar função de validação de CNPJ
- [x] Adicionar validação em tempo real no campo
- [x] Tornar campo opcional (para consumidor final sem documento)
- [x] Passar CPF/CNPJ para API de confirmação de pagamento
- [x] Incluir CPF/CNPJ na emissão da NFC-e (já implementado no backend)
- [ ] Testar com CPF válido
- [ ] Testar com CNPJ válido
- [ ] Testar sem documento (consumidor final)

## Implementar Campo Inscrição Estadual e Tributação Diferenciada

- [x] Adicionar campo "Inscrição Estadual" no checkout
- [x] Campo IE aparece apenas quando CNPJ for detectado
- [x] Validar formato da IE (apenas números, 9-14 dígitos)
- [x] Tornar campo opcional
- [x] Adicionar dica visual sobre benefício fiscal
- [x] Passar IE para API de confirmação de pagamento
- [x] Atualizar interface do router para aceitar IE
- [x] Implementar lógica no backend: detectar se cliente tem IE
- [x] Se CNPJ + IE informado → CST 020 (base reduzida 7%)
- [x] Se CPF ou sem IE → CST 040 (isento)
- [x] Atualizar cálculos de ICMS no focus-nfe.ts
- [x] Adicionar campo dest_ie na NFC-e quando informado
- [x] Testar com CNPJ + IE (deve aplicar CST 020)
- [x] Testar com CNPJ sem IE (deve aplicar CST 040)
- [x] Testar com CPF (deve aplicar CST 040)
- [x] Testar sem documento (deve aplicar CST 040)
- [x] Validar cálculos de ICMS na nota emitida

## Implementar Consulta Automática de CNPJ e Validação de IE

- [x] Criar serviço de consulta de CNPJ (Brasil API ou ReceitaWS)
- [x] Adicionar endpoint no backend para consultar CNPJ
- [ ] Implementar debounce na consulta (evitar muitas requisições)
- [x] Adicionar campo "Razão Social" no checkout (readonly quando preenchido automaticamente)
- [x] Adicionar campo "UF" no checkout (readonly quando preenchido automaticamente)
- [x] Implementar busca automática ao completar CNPJ (14 dígitos)
- [x] Mostrar loading durante consulta
- [x] Preencher automaticamente Razão Social da API
- [x] Preencher automaticamente IE da API (se disponível)
- [x] Preencher automaticamente UF da API
- [x] Permitir edição manual se API falhar ou dados estiverem incorretos
- [ ] Criar biblioteca de validação de IE por UF (client/src/lib/ieValidation.ts)
- [ ] Implementar validação de dígito verificador para SP
- [ ] Implementar validação de dígito verificador para RJ, MG e outros estados
- [ ] Integrar validação de IE com campo UF
- [ ] Mostrar mensagem de erro específica quando IE for inválida para aquele estado
- [x] Passar razaoSocial e UF para API de confirmação de pagamento
- [x] Atualizar interface do router para aceitar razaoSocial e uf
- [x] Usar Razão Social no campo nome_destinatario da NFC-e
- [x] Adicionar UF do destinatário na NFC-e
- [x] Testar consulta automática de CNPJ
- [x] Testar preenchimento automático de dados
- [ ] Testar validação de IE para diferentes estados (implementar validação por UF)
- [ ] Validar dados corretos na NFC-e emitida

## Adicionar Data/Hora em Todos os IDs Gerados

- [x] Atualizar referência da NFC-e para incluir data/hora (formato: VENDA_YYYYMMDD_HHMMSS)
- [ ] Atualizar ID do pedido para incluir data/hora no banco de dados
- [x] Atualizar referência do PIX para incluir data/hora
- [x] Criar função utilitária para gerar IDs com timestamp
- [x] Testar geração de IDs com formato correto
- [x] Validar que IDs são únicos e legíveis

## Emitir NFC-e Automaticamente para Pagamentos com Cartão

- [x] Adicionar emissão de NFC-e no endpoint processPayment quando aprovado
- [x] Passar CPF/CNPJ, Razão Social, IE e UF para processPayment
- [x] Retornar dados da NFC-e junto com resultado do pagamento
- [x] Atualizar interface do processPayment para incluir dados do cliente
- [x] Atualizar frontend para capturar e enviar dados do cliente no pagamento com cartão
- [x] Exibir modal de sucesso com NFC-e após aprovação do cartão
- [x] Enviar DANFE por email automaticamente
- [x] Testar fluxo completo: cartão → aprovação → NFC-e → email

## Implementar Histórico de Notas Fiscais no Painel Admin

- [x] Criar endpoint para listar todas as NFC-e do banco de dados
- [x] Adicionar filtros: data inicial, data final, cliente, status
- [x] Ordenar por data de emissão (mais recentes primeiro)
- [x] Criar página AdminNFCe.tsx no painel admin
- [x] Exibir tabela com: número, série, data, cliente, valor, status, chave de acesso
- [x] Adicionar botões de ação: visualizar DANFE, baixar XML, copiar chave
- [x] Implementar busca por número da nota ou chave de acesso
- [x] Adicionar paginação (20 notas por página)
- [x] Mostrar totalizadores: total de notas, valor total
- [x] Adicionar link no menu do admin para "Notas Fiscais"
- [x] Testar filtros e busca
- [x] Validar exibição de dados

## Implementar Exportação de Relatórios (Excel/PDF)

- [x] Instalar biblioteca para gerar Excel (exceljs)
- [x] Criar endpoint para exportar relatório em Excel
- [x] Criar endpoint para exportar relatório em PDF
- [x] Usar mesmos filtros da listagem (data, status, busca)
- [x] Incluir todas as colunas: número, data, cliente, CPF/CNPJ, valor, status
- [x] Adicionar totalizadores no rodapé (quantidade e valor total)
- [x] Adicionar botões "Exportar Excel" e "Exportar PDF" na página AdminNFCe
- [x] Gerar nome de arquivo com data atual (ex: notas_fiscais_2025-12-02.xlsx)
- [ ] Testar exportação com filtros aplicados

## Implementar Reemissão de DANFE

- [x] Adicionar botão "Reenviar Email" na tabela de notas
- [x] Criar modal para inserir email do destinatário
- [x] Criar endpoint nfce.reenviarEmail no backend
- [x] Adicionar botão "WhatsApp" na tabela de notas
- [x] Gerar mensagem formatada com link do DANFE, chave e QR Code
- [x] Abrir WhatsApp automaticamente com mensagem pronta
- [x] Mostrar toast de sucesso após reenvio
- [x] Integrar endpoint com frontend
- [x] Adicionar estado de loading no botão de envio

## Criar Dashboard de Vendas (Em Progresso)

- [x] Instalar biblioteca de gráficos (recharts)
- [x] Criar endpoint para estatísticas de vendas
- [x] Criar endpoint para faturamento diário
- [x] Criar endpoint para faturamento mensal
- [x] Criar endpoint para produtos mais vendidos
- [x] Registrar dashboardRouter no appRouter
- [x] Criar página AdminDashboard.tsx
- [x] Adicionar rota /admin/dashboard
- [x] Cards com métricas: vendas hoje, vendas mês, ticket médio, total de clientes
- [x] Gráfico de faturamento diário (últimos 30 dias)
- [x] Gráfico de faturamento mensal (últimos 12 meses)
- [x] Top 10 produtos mais vendidos com gráfico de barras
- [x] Comparativo de períodos (mês atual vs mês anterior)
- [x] Adicionar link no header do admin para "Dashboard"

## Desabilitar Pagamento PIX Temporariamente

- [x] Remover opção PIX da página de checkout
- [x] Comentar código para facilitar reativação futura
- [x] Testar checkout sem opção PIX

## Adicionar Banner "Em Breve" na Home

- [x] Criar componente de banner informativo
- [x] Adicionar mensagem "Loja em fase de testes - Compras online em breve!"
- [x] Posicionar banner de forma destacada no topo da home
- [x] Adicionar opção para fechar/ocultar o banner
- [x] Testar visualização em desktop e mobile

## Criar Página "Como Chegar" (Cancelado - Erro de Compilação)

- [x] Tentativa inicial causou erro no site
- [x] Rollback realizado com sucesso
- [x] Site restaurado e funcionando normalmente
- [ ] Aguardando decisão do usuário para nova tentativa

## Criar Página "Como Chegar" Simplificada (Versão 2)

- [x] Criar página ComoChegar.tsx sem mapa interativo
- [x] Adicionar iframe do Google Maps (estático)
- [x] Exibir endereço completo e formatado
- [x] Mostrar horários de funcionamento
- [x] Adicionar informações de contato (telefone, email)
- [x] Botão "Abrir no Google Maps" (link externo)
- [x] Botão "Copiar Endereço" com toast
- [x] Card de formas de pagamento
- [x] Criar rota /como-chegar
- [x] Adicionar link no header
- [x] Testar responsividade e funcionamento

## Integração Newsletter com Mailchimp
- [x] Instalar biblioteca @mailchimp/mailchimp_marketing
- [x] Criar módulo server/mailchimp.ts com integração
- [x] Criar endpoint tRPC newsletter.subscribe
- [x] Atualizar componente Newsletter.tsx para usar API
- [x] Adicionar variáveis de ambiente MAILCHIMP_API_KEY e MAILCHIMP_LIST_ID
- [x] Criar documentação de configuração
- [x] Testar cadastro real no Mailchimp

## Sistema de Gestão de Estoque com Leitor de Código de Barras
- [ ] Ajustar diálogo de edição de produtos para ter scroll interno e sempre mostrar botão salvar
- [ ] Validar que código de barras é salvo corretamente
- [ ] Cadastrar códigos EAN-13 nos 5 produtos existentes
- [ ] Testar sistema de entrada rápida com produtos cadastrados
- [ ] Corrigir backend para salvar campo ean13 ao atualizar produto
- [ ] Usar BarcodeInput no formulário de edição de produtos

## Correção: Formulário de Cadastro Rápido Não Aparece

- [ ] Investigar por que formulário de cadastro rápido não aparece quando produto não é encontrado no AdminQuickStock
- [ ] Verificar lógica de exibição do formulário (showQuickRegister)
- [ ] Verificar se mutation createProduct está funcionando
- [ ] Corrigir e testar novamente

## Testes Automatizados - Formulário de Cadastro Rápido

- [x] Criar teste unitário para validar que formulário aparece quando produto não encontrado
- [x] Criar teste para validar que formulário aparece quando dá erro na busca
- [x] Adicionar documentação do comportamento esperado
- [x] Validar correção em produção

## Cache Busting Automático

- [x] Verificar configuração do Vite para versionamento de assets
- [x] Configurar hash nos nomes dos arquivos JS/CSS
- [x] Adicionar headers HTTP de cache corretos
- [x] Testar se arquivos são atualizados após deploy
- [x] Documentar estratégia de cache

## Bug: Botão Cadastrar Produto Desabilitado

- [ ] Investigar validação que bloqueia botão mesmo com campos preenchidos
- [ ] Corrigir lógica de habilitação do botão
- [ ] Testar cadastro completo

- [x] Melhorar feedback visual de sucesso no cadastro rápido de produtos
- [x] Aumentar duração do toast de sucesso de 5 para 10 segundos
- [x] Adicionar som de notificação ao cadastrar produto
- [x] Identificar e corrigir 2 erros no código do som de notificação
- [x] CRÍTICO: Corrigir erro do Resend que impede servidor de iniciar
- [ ] Adicionar navegação automática para aba Produtos após cadastro rápido
- [x] Implementar validação para impedir cadastro duplicado por código de barras
- [x] Integrar cadastro rápido com sistema de estoque
- [x] Adicionar campo de quantidade inicial no formulário
- [x] Registrar movimentação de entrada automática após cadastro

## Sistema de Estoque Profissional

- [x] Implementar cálculo de custo médio ponderado
- [ ] Criar importador de XML de NF-e para entrada de estoque
- [ ] Implementar ajustes manuais de entrada com motivo e auditoria
- [ ] Implementar ajustes manuais de saída com motivo e auditoria
- [ ] Criar sistema de baixa automática por vendas (loja online)
- [ ] Implementar controle de lotes e validade
- [ ] Criar relatório de movimentações por período
- [ ] Criar relatório de valor de estoque (custo médio)
- [ ] Criar relatório de produtos com estoque baixo
- [ ] Implementar dashboard de estoque em tempo real
- [ ] Criar APIs REST para integração com ERP externo
- [ ] Documentar endpoints de API para ERP
- [ ] Implementar webhook para notificar ERP de mudanças
- [ ] Criar tela de importação de XML de NF-e
- [ ] Validar e extrair dados de XML (produtos, quantidades, valores)
- [ ] Registrar entrada de estoque a partir de XML

## Sistema de Importação de NF-e (FASE 3 - Concluída)

- [x] Criar parser de XML de NF-e (nfeParser.ts)
- [x] Implementar processador de NF-e (nfeImporter.ts)
- [x] Criar router/endpoint para upload de XML (nfeRouter.ts)
- [x] Integrar router no appRouter (routers.ts)
- [x] Criar interface web para importação (AdminNFe.tsx)
- [x] Adicionar aba "Importar NF-e" no Admin.tsx
- [x] Implementar área de upload com drag & drop
- [x] Adicionar validação de XML antes da importação
- [x] Exibir resultado da importação com detalhes (fornecedor, produtos, valores)
- [x] Criar testes unitários para o parser (nfeParser.test.ts)
- [x] Corrigir conversão de números longos (chave de acesso) no parser
- [x] Integrar com sistema de custo médio ponderado
- [x] Registrar movimentações de estoque automaticamente
- [x] Criar ou atualizar produtos baseado no EAN da NF-e


## Sistema de Ajustes Manuais de Estoque com Auditoria (FASE 4 - Concluída)

- [x] Criar schema de banco de dados para ajustes manuais
- [x] Adicionar campo userId em stockMovements para rastreabilidade
- [x] Implementar enum de motivos de ajuste (inventário, perda, dano, vencimento, devolução, correção)
- [x] Criar router de ajustes manuais (adjustmentRouter.ts)
- [x] Implementar validações de segurança (permissões, limites)
- [x] Criar endpoint para registrar ajuste positivo (entrada manual)
- [x] Criar endpoint para registrar ajuste negativo (saída manual)
- [x] Implementar endpoint de histórico de ajustes com filtros
- [x] Criar interface web AdminAdjustments.tsx
- [x] Adicionar formulário de ajuste com seleção de produto, quantidade, motivo e observações
- [x] Implementar validação de quantidade disponível para ajustes negativos
- [x] Adicionar confirmação para ajustes grandes (>10% do estoque)
- [x] Criar tabela de histórico de ajustes com filtros (data, produto, usuário, motivo)
- [x] Implementar exportação de relatório de auditoria
- [x] Adicionar aba "Ajustes" no Admin.tsx
- [x] Criar testes unitários para ajustes manuais
- [x] Testar integração com custo médio ponderado


## Implementação de Envio de Emails para Agentes (MCP Gmail)

- [x] Criar EmailService usando Nodemailer (server/services/emailService.ts)
- [x] Criar templates HTML para cada tipo de email
- [x] Implementar envio de relatório diário (Agente de Legislação Fiscal)
- [x] Implementar envio de relatório consolidado (Agente de Relatórios Diários)
- [x] Implementar envio de alertas críticos
- [x] Implementar envio de relatório de produção
- [x] Criar exemplos de uso do EmailService
- [x] Criar script de teste com Nodemailer (test-email-nodemailer.mjs)
- [x] Documentar configuração completa (CONFIGURACAO_EMAIL_SERVICE.md)
- [ ] Configurar credenciais SMTP no .env (aguardando senha de app)
- [ ] Validar envio de emails em desenvolvimento


## Sistema de Baixa Automática de Estoque por Vendas (FASE 5 - Concluída)

- [x] Analisar fluxo atual de vendas (orders, orderItems)
- [x] Criar schema para reservas de estoque (stockReservations)
- [x] Implementar reserva de estoque ao criar pedido
- [x] Implementar liberação de reserva ao expirar tempo (15 min)
- [x] Criar endpoint para verificar disponibilidade antes de adicionar ao carrinho
- [x] Implementar baixa automática ao confirmar pagamento
- [x] Criar movimentação de estoque tipo "sale" (venda)
- [x] Implementar cancelamento de pedido com devolução ao estoque
- [x] Criar movimentação de estoque tipo "sale_cancellation" (cancelamento)
- [x] Adicionar validação de estoque disponível no checkout
- [x] Implementar bloqueio de venda quando estoque insuficiente
- [x] Criar job para limpar reservas expiradas
- [x] Criar router completo de vendas (salesRouter.ts)
- [x] Integrar salesRouter no appRouter
- [ ] Adicionar indicador de estoque disponível em tempo real no frontend
- [ ] Atualizar badge de "Estoque Baixo" considerando reservas
- [x] Criar testes unitários para reserva e baixa automática (9 testes completos)
- [x] Documentar fluxo completo de venda e estoque
- [ ] Testar cenário de múltiplos usuários comprando simultaneamente (aguardando acesso ao banco)
- [ ] Executar testes com banco de dados configurado


## Integração Frontend - Sistema de Baixa Automática (Concluída)

- [x] Criar hook useStockAvailability para verificar disponibilidade
- [x] Criar hook useMultipleStockAvailability para múltiplos produtos
- [x] Criar hook useStockReservation para gerenciar reservas
- [x] Criar componente StockBadge para mostrar estoque disponível
- [x] Criar componente StockIndicator (versão compacta)
- [x] Criar exemplo ProductCardWithStock integrado
- [x] Criar exemplo CheckoutWithStock integrado
- [x] Adicionar loading states durante verificação de estoque
- [x] Adicionar tratamento de erros (estoque insuficiente)
- [ ] Integrar nos componentes existentes do projeto
- [ ] Testar fluxo completo no navegador


## Sistema de Backup e Recuperação (Concluído)

- [x] Verificar status do repositório Git
- [x] Fazer commit e push para GitHub (48 arquivos, 19.080 linhas)
- [x] Criar script de backup automático do banco de dados (backup-database.sh)
- [x] Criar script de backup automático de arquivos S3 (backup-s3.sh)
- [x] Criar script de backup completo (backup-all.sh)
- [x] Criar backup local completo do projeto (75 MB)
- [x] Documentar processo completo (README.md)
- [x] Documentar guia de backup e recuperação (BACKUP_E_RECUPERACAO_DADOS.md)
- [ ] Configurar cron jobs para backup automático (aguardando servidor de produção)
- [ ] Configurar GitHub Actions para backup automático (opcional)
- [ ] Testar restauração de backup (aguardando acesso ao banco)


## FASE 6: Relatórios de Estoque

- [x] Criar router de relatórios (reportsRouter.ts)
- [x] Implementar relatório de posição de estoque (por filial, produto, categoria)
- [x] Implementar relatório de movimentações (entradas, saídas, ajustes)
- [x] Implementar relatório de produtos com estoque baixo
- [x] Implementar relatório de custo médio ponderado
- [x] Criar endpoint para exportação em CSV (frontend)
- [x] Criar interface AdminReports.tsx
- [x] Adicionar filtros de data, filial, produto, categoria
- [x] Adicionar gráficos de evolução de estoque
- [x] Adicionar gráfico de top produtos mais movimentados
- [x] Adicionar estatísticas gerais (valor total, itens, alertas)
- [x] Integrar rota no App.tsx
- [ ] Criar testes unitários para reportsRouter

## FASE 7: APIs REST Públicas

- [x] Criar router de API pública (publicApiRouter.ts)
- [x] Implementar endpoint de consulta de disponibilidade
- [x] Implementar endpoint de criação de reserva
- [x] Implementar endpoint de confirmação de reserva
- [x] Implementar endpoint de cancelamento de reserva
- [x] Implementar endpoint de listagem de produtos
- [x] Implementar endpoint de health check
- [x] Criar middleware de autenticação por API key
- [x] Criar página de documentação da API (ApiDocs.tsx)
- [x] Criar exemplos de integração (JavaScript, Python, PHP)
- [x] Integrar rota no App.tsx
- [ ] Implementar sistema de API keys no banco de dados
- [ ] Implementar rate limiting (100 req/min por API key)
- [ ] Implementar webhooks para notificações de estoque baixo
- [ ] Criar testes unitários para publicApiRouter

## FASE 8: Controle de Lotes e Validade

- [x] Tabela stockBatches já existe no schema
- [x] Campos batchNumber, entryDate, expiryDate já existem
- [x] Criar router de lotes (batchRouter.ts)
- [x] Implementar endpoint de criação de lote
- [x] Implementar endpoint de listagem de lotes
- [x] Implementar endpoint de busca por ID
- [x] Implementar endpoint de atualização de lote
- [x] Implementar endpoint de baixa manual (withdraw)
- [x] Implementar lógica FIFO (First In, First Out) - withdrawFIFO
- [x] Criar sistema de alertas de produtos próximos ao vencimento (expiryAlerts)
- [x] Criar interface AdminBatches.tsx
- [x] Adicionar filtros por produto, loja, status
- [x] Adicionar criação de lotes via modal
- [x] Adicionar alertas visuais de validade (3 níveis)
- [x] Integrar rota no App.tsx
- [x] Atualização automática de custo médio ponderado
- [x] Integrar lotes com importação de NF-e (criação automática)
- [x] Integrar lotes com baixa de estoque (venda com FIFO)
- [x] Registrar unitCost do lote na movimentação (CMV)
- [x] Criar endpoint de rastreabilidade completa (NF-e → Lote → Venda)
- [ ] Criar testes unitários para batchRouter


## Sistema Configurável de Valoração de Estoque (FIFO vs Custo Médio)

- [x] Adicionar campo `stockValuationMethod` à tabela stores (enum: 'fifo', 'average_cost')
- [x] Gerar migração do schema (drizzle/0008_groovy_hex.sql)
- [x] Implementar função withdrawFIFO no salesRouter
- [x] Implementar função withdrawAverageCost no salesRouter
- [x] Criar função de roteamento automático baseada na configuração
- [x] Modificar completeReservationAndUpdateStock para usar método configurado
- [x] Criar storesRouter com endpoints getAll, getById, update
- [x] Criar interface AdminStockSettings com explicação dos métodos
- [x] Adicionar seleção de loja e método
- [x] Integrar rota no App.tsx
- [x] Adicionar documentação sobre os dois métodos na interface
- [ ] Aplicar migração no banco (aguardando credenciais)
- [ ] Testar ambos os métodos de valoração


## Regime Tributário e Simulador de Economia Fiscal

- [x] Adicionar campo `taxRegime` à tabela stores (enum: 'simples', 'presumido', 'real', 'arbitrado')
- [x] Gerar migração do schema (drizzle/0009_fixed_sentinel.sql)
- [x] Atualizar AdminStockSettings com seleção de regime tributário
- [x] Adicionar avisos inteligentes baseados no regime
- [x] Mostrar aviso de economia apenas para Lucro Real
- [x] Mostrar aviso de "sem impacto" para Simples/Presumido
- [x] Atualizar card de loja para exibir regime tributário
- [x] Integrar taxRegime no storesRouter (update)
- [ ] Criar relatório de economia tributária
- [ ] Documentar uso completo do sistema


## Módulo Completo de Cadastro de Produtos

### Schema e Banco de Dados
- [x] Criar tabela productTaxInfo (informações fiscais: NCM, CEST, CFOP, CST, alíquotas)
- [x] Criar tabela productCommercialInfo (preços, margem, desconto, comissão)
- [x] Criar tabela productStockInfo (estoque mínimo/máximo, lote, validade)
- [x] Criar tabela productSuppliers (fornecedores do produto)
- [x] Criar tabela suppliers (cadastro de fornecedores)
- [x] Gerar migração do schema (drizzle/0010_boring_unus.sql)

### Backend (Routers)
- [x] Criar productsRouter completo (CRUD + informações adicionais)
- [x] Criar suppliersRouter (CRUD de fornecedores)
- [x] Criar endpoint de cálculo automático de preço (calculatePrice)
- [x] Criar endpoint de busca de produtos (com filtros avançados)
- [x] Criar endpoint de busca por código de barras
- [x] Criar endpoint de listagem de categorias
- [x] Integrar com routers existentes

### Frontend (Interface)
- [ ] Criar página AdminProducts (listagem de produtos)
- [ ] Criar página AdminProductForm (cadastro/edição com abas)
- [ ] Aba 1: Informações Básicas (nome, descrição, categoria, imagem)
- [ ] Aba 2: Informações Fiscais (NCM, CEST, CFOP, CST, alíquotas)
- [ ] Aba 3: Informações Comerciais (preços, margem, desconto)
- [ ] Aba 4: Informações de Estoque (mínimo, máximo, lote, validade)
- [ ] Aba 5: Fornecedores (vincular fornecedores ao produto)
- [ ] Criar componente de busca de NCM (com API da Receita)
- [ ] Criar componente de cálculo de margem (automático)
- [ ] Adicionar validações de formulário

### Funcionalidades Avançadas
- [ ] Importação de produtos via CSV/Excel
- [ ] Exportação de produtos
- [ ] Duplicar produto
- [ ] Histórico de alterações de preço
- [ ] Cálculo automático de preço de venda (baseado em margem)
- [ ] Sugestão de preço competitivo

### Documentação
- [ ] Documentar estrutura de dados
- [ ] Criar guia de uso do cadastro de produtos
- [ ] Documentar cálculos de impostos


## Agente de Monitoramento de Notícias Fiscais e Contábeis

### Estrutura e Configuração
- [x] Criar arquivo de configuração (config/newsAgentConfig.ts)
- [x] Definir palavras-chave de monitoramento (critical, high, medium, low)
- [x] Definir fontes oficiais (DOU, RFB, CONFAZ, CFC, MAPA, CONAB)
- [x] Configurar prioridades de notícias
- [x] Configurar categorias (legislation, taxation, accounting, agribusiness, compliance, market)

### Scrapers e Coleta
- [x] Criar scraper do Diário Oficial da União (DOU)
- [x] Criar scraper da Receita Federal
- [x] Criar scraper do CONFAZ
- [x] Criar scraper do CFC
- [x] Criar scraper do MAPA
- [x] Criar scraper da CONAB
- [x] Implementar sistema de cache de notícias
- [x] Criar scraper genérico (fallback)

### Classificação e Filtragem
- [x] Criar sistema de classificação por relevância
- [x] Implementar filtro de palavras-chave
- [x] Criar sistema de priorização (critical, high, medium, low)
- [x] Implementar detecção de duplicatas (por ID)
- [x] Implementar cálculo de score de relevância

### Email e Notificação
- [x] Criar template HTML do email (responsivo)
- [x] Implementar formatação de notícias por categoria
- [x] Criar resumo executivo com estatísticas
- [x] Adicionar badges de prioridade
- [x] Adicionar links para fontes oficiais

### Integração e Scheduler
- [x] Criar newsMonitoringAgent.ts
- [x] Integrar com scheduler (cron 0 8 * * 1-5)
- [x] Configurar destinatários de email (diretoria, contador, fiscal)
- [x] Implementar sistema de log
- [x] Adicionar função sendEmail genérica no emailService

### Testes
- [ ] Testar scrapers individualmente
- [ ] Testar classificação de notícias
- [ ] Testar envio de email
- [ ] Testar agendamento
